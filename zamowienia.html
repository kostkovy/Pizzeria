<!DOCTYPE html>
<html lang="pl-PL">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pizzeria Podp≈Çomie≈Ñ! Najlepsza pizza w internecie!</title>
    <link rel="icon" type="image/x-icon" href="src/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="logo">
                Pizzeria Podp≈Çomie≈Ñ
                <img src="src/img/logo.png" height="50px" width="50px" alt="logo pizzerii">
            </div>
            <nav class="menu-links">
                <a href="index.html">Strona g≈Ç√≥wna</a>
                <a href="menu.html">Menu</a>
                <a href="#" id="dark-mode-toggle">Tryb Ciemny</a>
            </nav>
        </div>
    </header>

    <div class="pizza-builder-container">
        <div class="pizza-canvas">
            <h2>Twoja pizza üçï</h2>
            <canvas id="pepperoniPizzaCanvas" width="400" height="400" style="border: 1px solid #ccc; background-color: #f0f0f0;"></canvas>
        </div>
        <div class="ingredient-panel">
            <h3>Sk≈Çadniki:</h3>
            <div id="ingredientList"></div>
        </div>
    </div>
    <div class="price-container" style="margin-top: 20px; text-align: center;">
    <h3>Ca≈Çkowita cena:</h3>
    <div id="price" style="font-size: 2em; font-weight: bold; color: rgb(151, 18, 18); margin-bottom: 15px;">0 z≈Ç</div>
    <button id="summaryBtn" style="
        background-color: rgb(151, 18, 18);
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 6px;
        font-weight: bold;
        cursor: pointer;
        font-size: 1em;
        transition: background-color 0.3s ease;
    ">Podsumowanie</button>
</div>


    <script>
   const ingredients = {
    pepperoni: { name: 'Pepperoni', img: 'src/img/peperoni.png' },
    ham: { name: 'Szynka', img: 'src/img/ham.png' },
    garlic: { name: 'Czosnek', img: 'src/img/garlic.png' },
    onion: { name: 'Cebula', img: 'src/img/onion.png' },
    corn: { name: 'Kukurydza', img: 'src/img/corn.png' },
    pineapple: { name: 'Ananas', img: 'src/img/pineapple.png' },
    olives: { name: 'Czarne oliwki', img: 'src/img/olives.png' },
    jalapeno: { name: 'Jalapeno', img: 'src/img/jalapeno.png' },
    oregano: { name: 'Oregano', img: 'src/img/oregano.png' },
    greenpepper: { name: 'Zielona papryka', img: 'src/img/greenpepper.png' },
    mushrooms: { name: 'Pieczarki', img: 'src/img/mushrooms.png' },
    tomato: { name: 'Pomidorki koktajlowe', img: 'src/img/tomato.png' }
};

const canvas = document.getElementById('pepperoniPizzaCanvas');
const ctx = canvas.getContext('2d');

const baseConfig = {};
const extraConfig = {};
for (const key in ingredients) {
    baseConfig[key] = parseInt(localStorage.getItem(key)) || 0;
    extraConfig[key] = 0;
}

let basePrice = parseInt(localStorage.getItem('Cena')) || 0;
let price = basePrice;

function updatePrice() {
    let extraCount = 0;
    for (const key in extraConfig) {
        extraCount += extraConfig[key];
    }
    price = basePrice + extraCount * 2;
    if (price < basePrice) price = basePrice;
    document.getElementById('price').innerText = price + ' z≈Ç';
}

function drawPizzaBase() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.fillStyle = '#f5d742';
    ctx.arc(200, 200, 180, 0, Math.PI * 2);
    ctx.fill();

    ctx.beginPath();
    ctx.strokeStyle = '#d4a42c';
    ctx.lineWidth = 15;
    ctx.arc(200, 200, 180, 0, Math.PI * 2);
    ctx.stroke();

    ctx.beginPath();
    ctx.fillStyle = '#d62828';
    ctx.arc(200, 200, 165, 0, Math.PI * 2);
    ctx.fill();

    ctx.beginPath();
    ctx.fillStyle = 'rgba(255,255,0,0.4)';
    ctx.arc(200, 200, 160, 0, Math.PI * 2);
    ctx.fill();
}

function drawSlices() {
    ctx.beginPath();
    ctx.strokeStyle = '#000';
    ctx.lineWidth = 1;
    for (let i = 0; i < 8; i++) {
        const a = i * Math.PI / 4;
        ctx.moveTo(200, 200);
        ctx.lineTo(200 + Math.cos(a) * 180, 200 + Math.sin(a) * 180);
    }
    ctx.stroke();
}

function generatePositions(count, minR = 50, maxR = 160, minD = 30) {
    const pos = [], c = { x: 200, y: 200 };
    while (pos.length < count) {
        const a = Math.random() * Math.PI * 2;
        const d = minR + Math.random() * (maxR - minR);
        const x = c.x + Math.cos(a) * d,
            y = c.y + Math.sin(a) * d;
        if (!pos.some(p => Math.hypot(p.x - x, p.y - y) < minD)) {
            pos.push({ x, y, size: 30 + Math.random() * 10 });
        }
    }
    return pos;
}

function loadImage(src) {
    return new Promise((res, rej) => {
        const i = new Image();
        i.onload = () => res(i);
        i.onerror = rej;
        i.src = src;
    });
}

async function drawIngredients() {
    for (const key in ingredients) {
        const total = baseConfig[key] + extraConfig[key];
        if (total > 0) {
            try {
                const img = await loadImage(ingredients[key].img);
                const positions = generatePositions(total);
                positions.forEach(p => {
                    ctx.drawImage(img, p.x - p.size / 2, p.y - p.size / 2, p.size, p.size);
                });
            } catch (e) {
                console.warn(`B≈ÇƒÖd ≈Çadowania obrazka: ${ingredients[key].img}`, e);
            }
        }
    }
}

async function drawPizza() {
    drawPizzaBase();
    await drawIngredients();
    drawSlices();
}

function setupIngredientPanel() {
    const list = document.getElementById('ingredientList');
    for (const key in ingredients) {
        const item = document.createElement('div');
        item.className = 'ingredient-item';
        item.innerHTML = `
            <span>${ingredients[key].name}</span>
            <button data-key="${key}" data-action="-">‚àí</button>
            <span id="count-${key}">0</span>
            <button data-key="${key}" data-action="+">+</button>
        `;
        list.appendChild(item);
    }

    list.addEventListener('click', e => {
        if (e.target.tagName === 'BUTTON') {
            const key = e.target.dataset.key;
            const act = e.target.dataset.action;
            if (act === '+') {
                extraConfig[key]++;
            } else if (act === '-' && extraConfig[key] > 0) {
                extraConfig[key]--;
            }
            document.getElementById(`count-${key}`).innerText = extraConfig[key];
            updatePrice();
            drawPizza();
        }
    });
}

document.addEventListener('DOMContentLoaded', () => {
    setupIngredientPanel();
    updatePrice();
    drawPizza();

    document.getElementById('summaryBtn').addEventListener('click', () => {
        window.location.href = 'summary.html';
    });
});

</script>

</body>
</html>
